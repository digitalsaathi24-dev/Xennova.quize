<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xennova Quiz - Dynamic Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --primary: #4834d4; --success: #2ecc71; --danger: #eb4d4b; --dark: #130f40; --light: #f5f6fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--light); margin: 0; display: flex; }
        
        /* Sidebar/Dashboard Layout */
        .sidebar { width: 260px; background: var(--dark); color: white; height: 100vh; position: fixed; padding: 20px; box-sizing: border-box; }
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; }
        
        /* Stats Cards */
        .dashboard-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        .stat-card h3 { margin: 0; color: #666; font-size: 14px; }
        .stat-card p { margin: 5px 0 0; font-size: 28px; font-weight: bold; color: var(--dark); }

        /* Form & Tables */
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { cursor: pointer; border: none; font-weight: bold; transition: 0.3s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-update { background: #f0932b; color: white; display: none; }
        .btn-excel { background: var(--success); color: white; width: auto; padding: 10px 20px; float: right; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: var(--dark); font-size: 14px; }
        
        .action-btns { display: flex; gap: 5px; }
        .edit-btn { background: #f0932b; color: white; padding: 5px 10px; font-size: 12px; border-radius: 4px; }
        .del-btn { background: var(--danger); color: white; padding: 5px 10px; font-size: 12px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>Quiz Admin</h2>
    <hr style="opacity: 0.2;">
    <p>Live Dashboard</p>
    <small>Manage your students and questions in real-time.</small>
</div>

<div class="main-content">
    <div class="dashboard-stats">
        <div class="stat-card">
            <h3>Total Questions</h3>
            <p id="totalQue">0</p>
        </div>
        <div class="stat-card" style="border-color: #2ecc71;">
            <h3>Students Appeared</h3>
            <p id="totalStudents">0</p>
        </div>
    </div>

    <div class="card">
        <h3 id="form-title">Add New Question</h3>
        <input type="hidden" id="edit-key">
        <input type="text" id="que" placeholder="Enter Question Text">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <input type="text" id="opt1" placeholder="Option 1">
            <input type="text" id="opt2" placeholder="Option 2">
            <input type="text" id="opt3" placeholder="Option 3">
            <input type="text" id="opt4" placeholder="Option 4">
        </div>
        <input type="number" id="ans" placeholder="Correct Answer Number (1-4)">
        <button id="add-btn" class="btn-add" onclick="saveQuestion()">Save Question</button>
        <button id="update-btn" class="btn-update" onclick="saveQuestion()">Update Changes</button>
        <button id="cancel-btn" style="display:none; background:#ccc;" onclick="resetForm()">Cancel</button>
    </div>

    <div class="card">
        <h3>Manage Questions</h3>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Question</th>
                        <th>Correct Ans</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="queTbody"></tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <button class="btn-excel" onclick="downloadExcel()">Download Results (Excel)</button>
        <h3>Student Results</h3>
        <div style="overflow-x: auto;">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Mobile</th>
                        <th>Address</th>
                        <th>Score</th>
                        <th>Date & Time</th>
                    </tr>
                </thead>
                <tbody id="resTbody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
     // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBqZ1L9ghya2U_xgqxWN5NWBuUwmTgpB-Y",
  authDomain: "xennova-quiz-app.firebaseapp.com",
  databaseURL: "https://xennova-quiz-app-default-rtdb.firebaseio.com",
  projectId: "xennova-quiz-app",
  storageBucket: "xennova-quiz-app.firebasestorage.app",
  messagingSenderId: "714199801850",
  appId: "1:714199801850:web:4cfb52a065b25b5fbace43",
  measurementId: "G-6L0HQBQJHC"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. SAVE OR UPDATE QUESTION
    function saveQuestion() {
        const key = document.getElementById("edit-key").value;
        const q = document.getElementById("que").value;
        const o1 = document.getElementById("opt1").value;
        const o2 = document.getElementById("opt2").value;
        const o3 = document.getElementById("opt3").value;
        const o4 = document.getElementById("opt4").value;
        const a = parseInt(document.getElementById("ans").value) - 1;

        if(!q || isNaN(a)) return alert("Please fill all fields!");

        const data = { question: q, options: [o1, o2, o3, o4], answer: a };

        if(key) {
            db.ref("questions/" + key).set(data).then(() => { alert("Updated!"); resetForm(); });
        } else {
            db.ref("questions").push(data).then(() => { alert("Added!"); resetForm(); });
        }
    }

    // 2. LIVE FETCH QUESTIONS
    db.ref("questions").on("value", (snap) => {
        const tbody = document.getElementById("queTbody");
        tbody.innerHTML = "";
        let count = 0;
        snap.forEach(child => {
            count++;
            const q = child.val();
            const id = child.key;
            tbody.innerHTML += `
                <tr>
                    <td>${count}</td>
                    <td>${q.question}</td>
                    <td>Option ${q.answer + 1}</td>
                    <td class="action-btns">
                        <button class="edit-btn" onclick="editMode('${id}', \`${q.question}\`, '${q.options[0]}', '${q.options[1]}', '${q.options[2]}', '${q.options[3]}', ${q.answer+1})">Edit</button>
                        <button class="del-btn" onclick="deleteQue('${id}')">Delete</button>
                    </td>
                </tr>`;
        });
        document.getElementById("totalQue").innerText = count;
    });

    // 3. LIVE FETCH RESULTS
    db.ref("results").on("value", (snap) => {
        const tbody = document.getElementById("resTbody");
        tbody.innerHTML = "";
        let count = 0;
        snap.forEach(child => {
            count++;
            const r = child.val();
            tbody.innerHTML += `
                <tr>
                    <td>${r.name}</td>
                    <td>${r.mobile}</td>
                    <td>${r.address || '-'}</td>
                    <td><b>${r.score}/${r.total}</b></td>
                    <td>${r.time || r.date}</td>
                </tr>`;
        });
        document.getElementById("totalStudents").innerText = count;
    });

    // EDIT & DELETE FUNCTIONS
    function deleteQue(id) { if(confirm("Are you sure?")) db.ref("questions/" + id).remove(); }

    function editMode(id, q, o1, o2, o3, o4, a) {
        document.getElementById("edit-key").value = id;
        document.getElementById("que").value = q;
        document.getElementById("opt1").value = o1; document.getElementById("opt2").value = o2;
        document.getElementById("opt3").value = o3; document.getElementById("opt4").value = o4;
        document.getElementById("ans").value = a;
        document.getElementById("add-btn").style.display = "none";
        document.getElementById("update-btn").style.display = "block";
        document.getElementById("cancel-btn").style.display = "block";
        window.scrollTo(0,0);
    }

    function resetForm() {
        document.querySelectorAll("input").forEach(i => i.value = "");
        document.getElementById("edit-key").value = "";
        document.getElementById("add-btn").style.display = "block";
        document.getElementById("update-btn").style.display = "none";
        document.getElementById("cancel-btn").style.display = "none";
    }

    // 4. EXCEL DOWNLOAD FUNCTION
    function downloadExcel() {
        let csv = "Name,Mobile,Address,Score,Date_Time\n";
        db.ref("results").once("value", (snap) => {
            snap.forEach(child => {
                const r = child.val();
                csv += `"${r.name}","${r.mobile}","${r.address}","${r.score}/${r.total}","${r.time || r.date}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'Quiz_Results_Report.csv';
            a.click();
        });
    }
</script>

</body>
</html>